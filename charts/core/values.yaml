global:
  project: core
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - ServerSideApply=true
      - ApplyOutOfSyncOnly=true
      - CreateNamespace=true

operators:
  authentik:
    enabled: true
    version: 0.0.15
    namespace: authentik
    repoURL: https://mortenolsen.pro/homelab-authentik-operator
    chart: authentik-operator

  cert-manager:
    enabled: true
    version: 1.19.2
    namespace: cert-manager
    repoURL: oci://quay.io/jetstack/charts/cert-manager
    path: .
    values:
      crds:
        enabled: true
      extraArgs:
        - --dns01-recursive-nameservers-only
        - --dns01-recursive-nameservers=8.8.8.8:53,1.1.1.1:53

  external-secrets:
    enabled: true
    version: 1.2.0
    namespace: external-secrets
    repoURL: https://charts.external-secrets.io
    chart: external-secrets
    values:
      installCRDs: true

  cloudnative-pg:
    enabled: true
    version: 0.27.0
    namespace: clooudnative-pg
    repoURL: https://cloudnative-pg.github.io/charts
    chart: cloudnative-pg

  falco:
    enabled: false
    version: 7.0.2
    namespace: falco
    repoURL: https://falcosecurity.github.io/charts
    chart: falco

  dns-operator:
    enabled: true
    version: 0.0.3
    namespace: falco
    repoURL: https://morten-olsen.github.io/homelab-dns-operator
    chart: dns-operator

  istio-base:
    enabled: true
    version: 1.28.2
    namespace: istio-system
    repoURL: https://istio-release.storage.googleapis.com/charts
    chart: base
    values:
      defaultRevision: default
      profile: ambient
    ignoreDifferences:
      - group: admissionregistration.k8s.io
        kind: ValidatingWebhookConfiguration
        name: istiod-default-validator
        jqPathExpressions:
          - .webhooks[]?.failurePolicy

  istiod:
    enabled: true
    version: 1.28.2
    namespace: istio-system
    repoURL: https://istio-release.storage.googleapis.com/charts
    chart: istiod
    values:
      meshConfig:
        # Enable Ingress support - Istio will handle Kubernetes Ingress resources
        # The gateway service is in the shared namespace (created by gateway chart)
        # Format: namespace/service-name (required when gateway is in different namespace than istio-system)
        ingressService: shared/istio-gateway
        # Match gateway pods with label istio=gateway (matches Gateway CR selector)
        # This tells Istio which gateway pods to use for ingress traffic
        ingressSelector: gateway
        # Enable DNS proxy to intercept DNS queries for mesh-internal hostnames
        # This ensures Istio intercepts DNS queries before they reach public DNS
        defaultConfig:
          proxyMetadata:
            # Enable DNS capture - Istio sidecar will intercept DNS queries
            ISTIO_META_DNS_CAPTURE: "true"
            # DNS auto allocate - automatically assign virtual IPs for ServiceEntry hosts
            ISTIO_META_DNS_AUTO_ALLOCATE: "true"
    ignoreDifferences:
      - group: admissionregistration.k8s.io
        kind: ValidatingWebhookConfiguration
        name: istio-validator-istio-system
        jqPathExpressions:
          - .webhooks[]?.failurePolicy

  kyverno:
    enabled: true
    version: 3.6.1
    namespace: kyverno
    repoURL: https://kyverno.github.io/kyverno
    chart: kyverno

  nuclei:
    enabled: false
    version: 0.2.9
    namespace: "{{ .Release.Namespace }}"
    repoURL: https://morten-olsen.github.io/homelab-nuclei-operator
    chart: nuclei-operator

  longhorn:
    enabled: true
    version: 1.10.1
    namespace: longhorn
    repoURL: https://charts.longhorn.io
    chart: longhorn
    values:
      defaultSettings:
        defaultReplicaCount: 1
        priorityClass: high-priority

  openebs:
    enabled: true
    version: 4.4.0
    namespace: openebs
    repoURL: https://openebs.github.io/openebs
    chart: openebs
    values:
      # https://github.com/openebs/dynamic-localpv-provisioner/blob/develop/deploy/helm/charts/values.yaml
      localpv-provisioner:
        hostpathClass:
          name: local-ebs
          reclaimPolicy: Retain
          isDefaultClass: false
      loki:
        enabled: false
      mayastor:
        enabled: false
        loki-stack:
          enabled: false
      engines:
        local:
          lvm:
            enabled: false
          zfs:
            enabled: false
          rawfile:
            enabled: false
        replicated:
          mayastor:
            enabled: false

  postgres:
    enabled: true
    version: 0.0.12
    namespace: postgres
    repoURL: https://mortenolsen.pro/homelab-postgres-operator
    chart: postgres-operator

  reflector:
    enabled: true
    version: 9.1.45
    namespace: reflector
    repoURL: oci://ghcr.io/emberstack/helm-charts/reflector
    path: .

  releader:
    enabled: false
    version: 2.2.7
    namespace: releader
    repoURL: https://stakater.github.io/stakater-charts
    chart: releader

  sealed-secrets:
    enabled: true
    version: 2.17.9
    namespace: sealed-secrets
    repoURL: https://bitnami-labs.github.io/sealed-secrets
    chart: sealed-secrets

  trivy:
    enabled: true
    version: 0.31.0
    namespace: trivy
    repoURL: https://aquasecurity.github.io/helm-charts
    chart: trivy-operator
